---
import { undefined } from "astro:schema";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import Breadcrumb from "../../components/Breadcrumb.astro";

export async function getStaticPaths() {
  const allPosts = await getCollection("product");
  allPosts.sort((x, y) => -new Date(x.data.date).getTime() - new Date(y.data.date).getTime());
  const uniqueCategories = [
    ...new Set(allPosts.map((post) => post.data.categories).flat()),
  ];

  const uniqueCategoriesWithoutUndefined = uniqueCategories.filter(
    (category: any) => category !== undefined,
  );

  return uniqueCategoriesWithoutUndefined.map((category: any) => {
    const filteredPosts = allPosts.filter((post) =>
      post.data.categories?.includes(category),
    );
    return {
      params: { category },
      props: { posts: filteredPosts },
    };
  });
  
}

const { category } = Astro.params;
const { posts } = Astro.props;
---

<Layout>
	<Breadcrumb lists={[{ name: "Categories", path: "product-categories" }, {name: category}]} />
  <h1>カテゴリー: {category}</h1>
  <main>
    {
      posts.map((post) => {
        return (
          <article>
            <header>
              <span class="posted-on">{post.data.date}に投稿</span>
              <h2 class="entry-title">
                <a href={`/product/${post.slug}`}>{post.data.title}</a>
              </h2>
            </header>
            <div class="entry-content">{/* <post.Content /> */}</div>
          </article>
        );
      })
    }
  </main>
</Layout>
